# API по работе с ФИО
Данный сервис реализован на языке Go с использованием библиотеки Gin Gonic. Для работы и миграций PostgreSQL использовался драйвер pgx. Для миграции использовалась библиотека goose, миграции выполняются автоматически при запуске сервиса. Тип операции зависит от определенного запроса. Для данных из файла конфигурации .env используется GoDotEnv.
Данные принимаются в JSON формате, далее сохраняются в базу данных PostgreSQL. Вывод данных происходит тоже в формате JSON. Реализованы все основные операции сохранения, изменения, получения и удаления.
При сохранении человека происходит запрос в 3 API: ageify, genderize и nationalize. Полученные данные сохраняются в БД вместе с введенными.
Для логгирования debug и info используется Zerolog.
Реализована спецификация на API в формате Swagger 2.0 с подходом code-first. Документация Swagger после запуска будет доступна по ссылке: http://localhost:8080/swagger/index.html#/
В Makefile прописаны возможные варианты запуска API и миграции.
## Есть 2 способа запуска микросервиса:
### 1. Локально.
   Необходимо в файле конфигурации .env указать
   ```
   HOST=localhost
   PORT=5436
   ```
   Запустить контейнер postgres
   ```
   docker run --name=db -e POSTGRES_PASSWORD='54321' -p 5436:5432 -d postgres
   ```
   Ввести в консоль команду
   ```
   go run cmd/main.go
   ```
   При необходимости, можно заменить названия контейнера базы данных, пароль и порты. Соответствующие параметры для такого же изменения находятся в .env. 
   Также, для отката миграции можно выполнить команду, для этого нужно установить goose (информация по ссылке: https://github.com/pressly/goose)
   ```
   make migrate-down
   ```
### 2. Локально при использовании docker-compose.
   
   Необходимо в файле конфигурации .env указать (По умолчанию в проекте стоит такое значение)
   ```
   HOST=db
   PORT=5432
   ```
   Ввести в консоль команду
   ```
   make build
   ```
## Пользование сервисом
### Для получения списка людей с фильтрацией по всем полям и пагинацией
```
curl --location --request GET 'http://localhost:8080/get_people?name={name}&surname={surname}&patronymic={patronymic}&nationality=&{RU}gender={gender}&age_min={0}&age_max={100}&page=1&limit=1&sort={sortColumn}&order={ASC or DESC}' \
--header 'Content-Type: application/json' \
--data ''
```
Данные в запросе указаны для примера. Для каждого параметра нужно ввести желаемый. 
Вместо page нужно ввести желаемое количество страниц с данными. Если поле оставить пустым, по умолчанию будет значение 1. 
Вместо limit нужно ввести желаемое количество данных на странице. Если поле оставить пустым, по умолчанию будет значение 10. 
Вместо sort название параметра по которому будет сортироваться список, а вместо order направление - по убыванию или возрастанию. 
Если оставить их пустыми, по умолчанию будет сортировка по id по возрастанию.
После успешного запроса будет выведен список сохранненых в базу данных людей.

#### Для добавления человека необходимо ввести запрос
```
curl --location  --request POST 'http://localhost:8080/create_person' \
--header 'Content-Type: application/json' \
--data '    {
            "name": "string",
            "patronymic": "string",
            "surname": "string"
            }'
```
В полях для добавления нужно ввести имя и фамилию. По желанию, можно ввести и отчество. По этим данным будут выполняться запросы в 3 API получение данных о возрасте, поле и стране происхождения.
После успешного запроса будет выведен идентификатор и сущность сохранненого человека. 

#### Для обновления сущности человека необходимо ввести запрос
```
curl --location --request PATCH 'http://localhost:8080/update_person?nameId={nameId}' \
--header 'Content-Type: application/json' \
--data '         {
                    "age": 0,
                    "gender": "string",
                    "name": "string",
                    "nationality": "string",
                    "patronymic": "string",
                    "surname": "string"
                    }'
```
Для исправления можно ввести любое нужное количество полей в указанном порядке. В адресе запроса вместо id указать идентификатор человека для изменения.

#### Для удаления сущности человека необходимо ввести запрос
```
curl --location --request DELETE 'http://localhost:8080/delete_person?nameId={nameId}' \
--header 'Content-Type: application/json' \
--data ''
```
В адресе запроса вместо id указать идентификатор фильма для удаления.
## Обработка ошибок
Для различных методов и вызовов функций реализована обработка ошибок, в зависимости от категории ошибки, выдается текст и код ошибки. Присуствуют коды 4хх и 5хх.
